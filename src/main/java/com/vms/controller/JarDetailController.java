package com.vms.controller;

import com.vms.entity.JarDetail;
import com.vms.service.JarDetailService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Controller
public class JarDetailController {

    @Autowired
    private JarDetailService jarDetailService;

    @GetMapping("/jarDetails")
    public String getJarDetailsByProjectVersion(@RequestParam("projectVersion") String projectVersion, Model model) {
        List<JarDetail> jarDetails = jarDetailService.getJarDetailsByProjectVersion(projectVersion);
        model.addAttribute("jarDetails", jarDetails);
        model.addAttribute("projectVersion", projectVersion);
        return "jarDetailList";
    }

    @GetMapping("/addJarDetail")
    public String showAddJarDetailForm(Model model) {
        model.addAttribute("jarDetail", new JarDetail());
        return "addJarDetail";
    }

    @PostMapping("/addJarDetail")
    public String addJarDetail(@ModelAttribute JarDetail jarDetail) {
        jarDetailService.addJarDetail(jarDetail);
        return "redirect:/jarDetails?projectVersion=" + jarDetail.getProjectVersion();
    }

    @GetMapping("/editJarDetail/{cve}")
    public String showEditJarDetailForm(@PathVariable String cve, Model model) {
        JarDetail jarDetail = jarDetailService.getJarDetailById(cve);
        model.addAttribute("jarDetail", jarDetail);
        return "editJarDetail";
    }

    @PostMapping("/editJarDetail")
    public String editJarDetail(@ModelAttribute JarDetail jarDetail) {
        jarDetailService.addJarDetail(jarDetail);
        return "redirect:/jarDetails?projectVersion=" + jarDetail.getProjectVersion();
    }

    @GetMapping("/deleteJarDetail/{cve}")
    public String deleteJarDetail(@PathVariable String cve) {
        JarDetail jarDetail = jarDetailService.getJarDetailById(cve);
        jarDetailService.deleteJarDetail(cve);
        return "redirect:/jarDetails?projectVersion=" + jarDetail.getProjectVersion();
    }
}
